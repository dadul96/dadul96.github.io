<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Mounting a Headlamp on a Mountain Bike | dadul96 blog</title>
<meta name="keywords" content="3D printing, photogrammetry, 3D design">
<meta name="description" content="Mounting a headlamp on a mountain bike using photogrammetry, CAD, 3D printing, and trial &amp; error üòÅ">
<meta name="author" content="dadul96">
<link rel="canonical" href="https://dadul96.github.io/posts/headlamp_on_a_bike/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://dadul96.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://dadul96.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://dadul96.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://dadul96.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://dadul96.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://dadul96.github.io/posts/headlamp_on_a_bike/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://dadul96.github.io/posts/headlamp_on_a_bike/">
  <meta property="og:site_name" content="dadul96 blog">
  <meta property="og:title" content="Mounting a Headlamp on a Mountain Bike">
  <meta property="og:description" content="Mounting a headlamp on a mountain bike using photogrammetry, CAD, 3D printing, and trial &amp; error üòÅ">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-09-18T15:15:03+01:00">
    <meta property="article:modified_time" content="2022-09-18T15:15:03+01:00">
    <meta property="article:tag" content="3D Printing">
    <meta property="article:tag" content="Photogrammetry">
    <meta property="article:tag" content="3D Design">
    <meta property="og:image" content="https://dadul96.github.io/posts/headlamp_on_a_bike/images/cover.webp">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://dadul96.github.io/posts/headlamp_on_a_bike/images/cover.webp">
<meta name="twitter:title" content="Mounting a Headlamp on a Mountain Bike">
<meta name="twitter:description" content="Mounting a headlamp on a mountain bike using photogrammetry, CAD, 3D printing, and trial &amp; error üòÅ">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://dadul96.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Mounting a Headlamp on a Mountain Bike",
      "item": "https://dadul96.github.io/posts/headlamp_on_a_bike/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Mounting a Headlamp on a Mountain Bike",
  "name": "Mounting a Headlamp on a Mountain Bike",
  "description": "Mounting a headlamp on a mountain bike using photogrammetry, CAD, 3D printing, and trial \u0026amp; error üòÅ\n",
  "keywords": [
    "3D printing", "photogrammetry", "3D design"
  ],
  "articleBody": "Mounting a headlamp on a mountain bike using photogrammetry, CAD, 3D printing, and trial \u0026 error üòÅ\nIntroduction So I have this lightweight mountain bike which I really enjoy driving around. Everything is trimmed to be lightweight and therefore some things like a bell or lights and reflectors are missing. Usually, this is no problem since I only drive it during daylight, but sometimes I would like to go for a ride later in the afternoon - with the possibility to get dark outside before I reach home again. Of course, I could just buy some off-the-shelf bike lights, but this has several drawbacks:\nFirst, this would be plane a$$ boring and not my style. A permanently mounted light on the bike handle is not useful at all when for example fixing a tire puncture in the middle of the woods in the dark. I already own a quite good headlamp which I would take with me anyway, because of the point above. Then I could just clip it off the bike and mount it on my head strap and vice versa. That‚Äôs why I came to the conclusion that it would be best to just design a mounting bracket for my bike. This allows me to completely drive without the light or just throw the headlamp into my backpack and clip it on in case it gets dusky. This way the only permanently added weight would be the mounting bracket.\nGoals to achieve It should be‚Ä¶\n‚Ä¶ 3D printed only -\u003e cheap and easy to manufacture. ‚Ä¶ lightweight. ‚Ä¶ aesthetically pleasing. ‚Ä¶ mounted in a way that it can survive a mild crash. ‚Ä¶ easy to mount. ‚Ä¶ able to mount it without any permanent modifications (i.e. drilling) on the bike. Planned Steps Reverse engineer how the lamp is mounted on the head strap. Design a simple interface/mount to just clip on the lamp itself. Test the design with an actual 3D printed test piece to re-iterate the design until finished. Take this test piece and check for possible mounting spots on the bike and determine the best one. Scan the bike handle with the help of photogrammetry. After generating a 3D model of the bike handle the rest of the mount can be designed to interface with the bike. Print the model and re-iterate until I‚Äôm happy with the result. Execution Reverse engineering the Mount on the Headstrap The headlamp used for this project is a Fenix HM50R V2.0. As you can see in the pictures below, the design allows the lamp to be easily removed from the head strap.\nSource: fenixstore.de\nSource: www.fenixlighting.com\nBesides this convenient feature, the headlamp also offers a quite good lighting performance in regards to brightness and runtime (see graph below).\nSource: www.fenixlighting.com\nUsing a caliper the adapter plate of the head strap has been measured and the prototype model has been designed in Fusion 360. During the design phase, several prototypes have been 3D printed (on my Voron V0) in black ABS. The physical prototypes enabled proper testing of the clip mechanism as well as its haptic feel of it. In the next step, I took this prototype with the mounted light to the bike and searched for the best mounting location. It seemed that the stem was the best place to mount the light since there were already 4pcs. of M6 screws attached which clamped down the handlebar.\nScanning the Handle with Photogrammetry The next action was to scan the bike handle with the help of photogrammetry.\nBut what is photogrammetry? The Wikipedia article offers a quite detailed description of what photogrammetry actually is, but explained in my own words:\nIt is a technique to get 3D information about a physical object with the help of images from the object. Algorithms (e.g. SIFT (Scale-invariant feature transform)) are then used to calculate the 3D data from the given pictures. Essentially, you take a lot of pictures of the object from different angles, and software tools are used to calculate a point cloud and mesh out of the given data. This mesh can then be converted into an STL file (Standard Triangle Language) for example.\nWhat is important when scanning (aka taking pictures of the object)? The object of desire should have a good color separation from the background. It should be non-reflective and evenly lit. More pictures are better. Pictures should overlap each other (2/3 overlap). Some software tools prefer to have the pictures ordered. The object to be scanned should fill the frame of the picture and not the background. Avoid harsh shadows. The images should be sharp and not shaky. Ideally, the camera settings such as focal length, aperture, and white balance should be kept constant. Of course, this also includes that all pictures should be taken with the same camera - duh. Avoid large areas with solid color and no texture. Or add texture using paint or stickers. For small objects, a turntable in combination with a tripod and studio lighting would be ideal. What software is out there? And what have I used? AliceVision Meshroom (FOSS) 3DF Zephyr (Free + Paid) RealityCapture (Paid) Regard3D (FOSS) PhotoModeler (Paid) Personally, I have used AliceVision‚Äôs Meshroom, because I like the FOSS software approach and the UI (see picture below). In addition, I have used the tool MeshLab (also FOSS) to post-process the generated 3D object. Trial and Error It actually took me 4 trials to get a somewhat useful scan of the bike handle and the stem.\nOn the first try, I took the Sony Alpha 6000 mirrorless camera and added some pieces of white masking tape to the handle. The results were okay, but I wanted to have even better results - especially around the area of the stem. Next up I tried the main camera of the Samsung Galaxy S21. I just wanted to see how far I can get with a phone camera. The results were quite disappointing, to be honest. I still did not give up the idea of using my phone to scan the object. Besides the difference in image quality between my Sony‚Äôs and Samsung‚Äôs images, the most obvious difference was the depth of field (DOF). As you might expect, the mirrorless camera had much more background blur. I thought this might help the algorithms to focus more on the object and less on the background. To prove this theory, I have tried to use the 3x zoom lens on the Galaxy S21. Also here, the results were not what I expected. Last but not least, I went back to the Sony Alpha and added even more pieces of white masking tape to help the algorithms, by providing distinguishable reference points all over the bike handle and stem. Miscellaneous Meshroom Camera Intrinsics When importing images into Meshroom you will see a yellow or green aperture symbol in the top left corner of the images. The yellow symbol shows that the camera intrinsics are approximated by the given metadata of the image. On contrary, the green aperture means that the camera intrinsics are calculated from the metadata and the camera sensor database.\nIn the case of the Samsung Galaxy S21, the sensor was not present in the database and therefore I got the following camera intrinsics: Using the Meshroom guide on GitHub I have added the phone‚Äôs sensor to the database and got the following results: Since it took me quite some time to get reliable information about the sensor size of the main camera on the Galaxy S21, I thought it makes sense to also contribute to the Meshroom/AliceVision project by creating a pull request (PR) for adding the sensor to the database.\nUsing MeshLab for cleaning up the Scan As you can see in the Trial and Error section above, some scans collect a lot of unwanted background stuff. I have used the FOSS tool MeshLab to clean up the model following this guide on YouTube.\nFinal Design After cleaning the model and exporting it as an STL file, it was imported into Fusion 360. Before the model can be used to design the holder it is necessary to scale it to fit real-life dimensions. Fortunately, Fusion offers an easy-to-use scale feature. You just need a reference point to compare the dimensions. In my case, I took the distance of the screws in the stem. Then you just divide the real-life value by the one you measured in your model. The result gives you then the scaling factor. Then the already designed clip interface was imported into this assembly. Even though I want to mount the light on the bottom of the bike stem, the design was done on the top side, since the scan was much better on the top of the stem. This was only possible because the stem showed symmetry between the top and bottom half. In the last step, the clip interface model was adapted to be mounted with the existing screws that hold the bike handle to the stem. By just using longer screws and cutting threads into the holes of the 3D printed part, it can be mounted without any additional modifications to the bike. Of course, also a chamfer was added to the part to interface more nicely with the stem. Result and Conclusion Overall I am happy with how the mount turned out. It only adds a few grams to the bike and it is mounted rock solid. Also in case of a mild crash, it is much more protected on the bottom side of the stem - compared to how typical bike lights are mounted. The modifications can quickly be undone and besides the changed screws the bike remained untouched. I am definitely looking forward to using photogrammetry more often for designing around complex shapes. Although, I have to admit that it was a bit overkill for this project. The other thing I have learned is that photogrammetry is a very time-consuming process. Not only does it take some time to prepare the object and take the pictures, but also a lot (if not the most) of time spent is waiting for the model to be generated. The bike light in action: ",
  "wordCount" : "1697",
  "inLanguage": "en",
  "image":"https://dadul96.github.io/posts/headlamp_on_a_bike/images/cover.webp","datePublished": "2022-09-18T15:15:03+01:00",
  "dateModified": "2022-09-18T15:15:03+01:00",
  "author":{
    "@type": "Person",
    "name": "dadul96"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://dadul96.github.io/posts/headlamp_on_a_bike/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "dadul96 blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://dadul96.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://dadul96.github.io/" accesskey="h" title="dadul96 blog (Alt + H)">dadul96 blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://dadul96.github.io/archives/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://dadul96.github.io/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://dadul96.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Mounting a Headlamp on a Mountain Bike
    </h1>
    <div class="post-meta"><span title='2022-09-18 15:15:03 +0100 +0100'>September 18, 2022</span>&nbsp;¬∑&nbsp;8 min&nbsp;¬∑&nbsp;dadul96

</div>
  </header> 
<figure class="entry-cover">
        <img loading="eager" src="https://dadul96.github.io/posts/headlamp_on_a_bike/images/cover.webp" alt="cover picture of bike and headlamp">
        
</figure><div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#goals-to-achieve" aria-label="Goals to achieve">Goals to achieve</a></li>
                <li>
                    <a href="#planned-steps" aria-label="Planned Steps">Planned Steps</a></li>
                <li>
                    <a href="#execution" aria-label="Execution">Execution</a><ul>
                        
                <li>
                    <a href="#reverse-engineering-the-mount-on-the-headstrap" aria-label="Reverse engineering the Mount on the Headstrap">Reverse engineering the Mount on the Headstrap</a></li>
                <li>
                    <a href="#scanning-the-handle-with-photogrammetry" aria-label="Scanning the Handle with Photogrammetry">Scanning the Handle with Photogrammetry</a><ul>
                        
                <li>
                    <a href="#but-what-is-photogrammetry" aria-label="But what is photogrammetry?">But what is photogrammetry?</a></li>
                <li>
                    <a href="#what-is-important-when-scanning-aka-taking-pictures-of-the-object" aria-label="What is important when scanning (aka taking pictures of the object)?">What is important when scanning (aka taking pictures of the object)?</a></li>
                <li>
                    <a href="#what-software-is-out-there-and-what-have-i-used" aria-label="What software is out there? And what have I used?">What software is out there? And what have I used?</a></li>
                <li>
                    <a href="#trial-and-error" aria-label="Trial and Error">Trial and Error</a></li>
                <li>
                    <a href="#miscellaneous" aria-label="Miscellaneous">Miscellaneous</a><ul>
                        
                <li>
                    <a href="#meshroom-camera-intrinsics" aria-label="Meshroom Camera Intrinsics">Meshroom Camera Intrinsics</a></li>
                <li>
                    <a href="#using-meshlab-for-cleaning-up-the-scan" aria-label="Using MeshLab for cleaning up the Scan">Using MeshLab for cleaning up the Scan</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#final-design" aria-label="Final Design">Final Design</a></li></ul>
                </li>
                <li>
                    <a href="#result-and-conclusion" aria-label="Result and Conclusion">Result and Conclusion</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p><em>Mounting a headlamp on a mountain bike using photogrammetry, CAD, 3D printing, and trial &amp; error</em> üòÅ</p>
<h1 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h1>
<p>So I have this lightweight mountain bike which I really enjoy driving around. Everything is trimmed to be lightweight and therefore some things like a bell or lights and reflectors are missing. Usually, this is no problem since I only drive it during daylight, but sometimes I would like to go for a ride later in the afternoon - with the possibility to get dark outside before I reach home again. Of course, I could just buy some off-the-shelf bike lights, but this has several drawbacks:</p>
<ul>
<li>First, this would be plane a$$ boring and not my style.</li>
<li>A permanently mounted light on the bike handle is not useful at all when for example fixing a tire puncture in the middle of the woods in the dark.</li>
<li>I already own a quite good headlamp which I would take with me anyway, because of the point above. Then I could just clip it off the bike and mount it on my head strap and vice versa.</li>
</ul>
<p>That&rsquo;s why I came to the conclusion that it would be best to just design a mounting bracket for my bike. This allows me to completely drive without the light or just throw the headlamp into my backpack and clip it on in case it gets dusky. This way the only permanently added weight would be the mounting bracket.</p>
<h1 id="goals-to-achieve">Goals to achieve<a hidden class="anchor" aria-hidden="true" href="#goals-to-achieve">#</a></h1>
<p>It should be&hellip;</p>
<ul>
<li>&hellip; 3D printed only -&gt; cheap and easy to manufacture.</li>
<li>&hellip; lightweight.</li>
<li>&hellip; aesthetically pleasing.</li>
<li>&hellip; mounted in a way that it can survive a mild crash.</li>
<li>&hellip; easy to mount.</li>
<li>&hellip; able to mount it without any permanent modifications (i.e. drilling) on the bike.</li>
</ul>
<h1 id="planned-steps">Planned Steps<a hidden class="anchor" aria-hidden="true" href="#planned-steps">#</a></h1>
<ol>
<li>Reverse engineer how the lamp is mounted on the head strap.</li>
<li>Design a simple interface/mount to just clip on the lamp itself.</li>
<li>Test the design with an actual 3D printed test piece to re-iterate the design until finished.</li>
<li>Take this test piece and check for possible mounting spots on the bike and determine the best one.</li>
<li>Scan the bike handle with the help of <a href="https://en.wikipedia.org/wiki/Photogrammetry">photogrammetry</a>.</li>
<li>After generating a 3D model of the bike handle the rest of the mount can be designed to interface with the bike.</li>
<li>Print the model and re-iterate until I&rsquo;m happy with the result.</li>
</ol>
<h1 id="execution">Execution<a hidden class="anchor" aria-hidden="true" href="#execution">#</a></h1>
<h2 id="reverse-engineering-the-mount-on-the-headstrap">Reverse engineering the Mount on the Headstrap<a hidden class="anchor" aria-hidden="true" href="#reverse-engineering-the-mount-on-the-headstrap">#</a></h2>
<p>The headlamp used for this project is a Fenix HM50R V2.0. As you can see in the pictures below, the design allows the lamp to be easily removed from the head strap.</p>
<figure>
    <img loading="lazy" src="images/fenix_hm50r_v2.webp"
         alt="picture of headlamp"/> <figcaption>
            <p>Source: <a href="https://fenixstore.de/Fenix-HM50R-V20-LED-Stirnlampe">fenixstore.de</a></p>
        </figcaption>
</figure>

<figure>
    <img loading="lazy" src="images/fenix_holder_assembly.webp"
         alt="picture of fenix holder assembly"/> <figcaption>
            <p>Source: <a href="https://www.fenixlighting.com/products/fenix-hm50r-v2-rechargeable-headlamp">www.fenixlighting.com</a></p>
        </figcaption>
</figure>

<p>Besides this convenient feature, the headlamp also offers a quite good lighting performance in regards to brightness and runtime (see graph below).</p>
<figure>
    <img loading="lazy" src="images/lamp_performance_graph.webp"
         alt="picture of lamp performance graph"/> <figcaption>
            <p>Source: <a href="https://www.fenixlighting.com/products/fenix-hm50r-v2-rechargeable-headlamp">www.fenixlighting.com</a></p>
        </figcaption>
</figure>

<p>Using a caliper the adapter plate of the head strap has been measured and the prototype model has been designed in <a href="https://www.autodesk.com/products/fusion-360/personal">Fusion 360</a>.
<img alt="picture of measuring the adapter plate" loading="lazy" src="/posts/headlamp_on_a_bike/images/measuring.webp">
<img alt="animated gif of design process" loading="lazy" src="/posts/headlamp_on_a_bike/images/construction.gif"></p>
<p>During the design phase, several prototypes have been 3D printed (on my <a href="https://vorondesign.com/voron0">Voron V0</a>) in black ABS.
<img alt="picture of the Voron V0 3D printer" loading="lazy" src="/posts/headlamp_on_a_bike/images/voron_v0.webp"></p>
<p>The physical prototypes enabled proper testing of the clip mechanism as well as its haptic feel of it.
<img alt="picture of the 3D printed prototypes" loading="lazy" src="/posts/headlamp_on_a_bike/images/3d_printed_prototypes.webp"></p>
<p>In the next step, I took this prototype with the mounted light to the bike and searched for the best mounting location. It seemed that the <a href="https://en.wikipedia.org/wiki/Stem_(bicycle_part)">stem</a> was the best place to mount the light since there were already 4pcs. of M6 screws attached which clamped down the handlebar.</p>
<h2 id="scanning-the-handle-with-photogrammetry">Scanning the Handle with Photogrammetry<a hidden class="anchor" aria-hidden="true" href="#scanning-the-handle-with-photogrammetry">#</a></h2>
<p>The next action was to scan the bike handle with the help of photogrammetry.</p>
<h3 id="but-what-is-photogrammetry">But what is photogrammetry?<a hidden class="anchor" aria-hidden="true" href="#but-what-is-photogrammetry">#</a></h3>
<p>The <a href="https://en.wikipedia.org/wiki/Photogrammetry">Wikipedia article</a> offers a quite detailed description of what photogrammetry actually is, but explained in my own words:</p>
<p>It is a technique to get 3D information about a physical object with the help of images from the object. Algorithms (e.g. <a href="https://en.wikipedia.org/wiki/Scale-invariant_feature_transform">SIFT (Scale-invariant feature transform)</a>) are then used to calculate the 3D data from the given pictures. Essentially, you take a lot of pictures of the object from different angles, and software tools are used to calculate a point cloud and mesh out of the given data. This mesh can then be converted into an STL file (<strong>S</strong>tandard <strong>T</strong>riangle <strong>L</strong>anguage) for example.</p>
<h3 id="what-is-important-when-scanning-aka-taking-pictures-of-the-object">What is important when scanning (aka taking pictures of the object)?<a hidden class="anchor" aria-hidden="true" href="#what-is-important-when-scanning-aka-taking-pictures-of-the-object">#</a></h3>
<ul>
<li>The object of desire should have a good color separation from the background.</li>
<li>It should be non-reflective and evenly lit.</li>
<li>More pictures are better.</li>
<li>Pictures should overlap each other (2/3 overlap).</li>
<li>Some software tools prefer to have the pictures ordered.</li>
<li>The object to be scanned should fill the frame of the picture and not the background.</li>
<li>Avoid harsh shadows.</li>
<li>The images should be sharp and not shaky.</li>
<li>Ideally, the camera settings such as focal length, aperture, and white balance should be kept constant. Of course, this also includes that all pictures should be taken with the same camera - duh.</li>
<li>Avoid large areas with solid color and no texture. Or add texture using paint or stickers.</li>
<li>For small objects, a turntable in combination with a tripod and studio lighting would be ideal.</li>
</ul>
<h3 id="what-software-is-out-there-and-what-have-i-used">What software is out there? And what have I used?<a hidden class="anchor" aria-hidden="true" href="#what-software-is-out-there-and-what-have-i-used">#</a></h3>
<ul>
<li><a href="https://alicevision.org/">AliceVision Meshroom</a> (FOSS)</li>
<li><a href="https://www.3dflow.net/3df-zephyr-photogrammetry-software/">3DF Zephyr</a> (Free + Paid)</li>
<li><a href="https://www.capturingreality.com/">RealityCapture</a> (Paid)</li>
<li><a href="https://www.regard3d.org/">Regard3D</a> (FOSS)</li>
<li><a href="https://www.photomodeler.com/">PhotoModeler</a> (Paid)</li>
</ul>
<p>Personally, I have used AliceVision&rsquo;s Meshroom, because I like the FOSS software approach and the UI (see picture below). In addition, I have used the tool <a href="https://www.meshlab.net/">MeshLab</a> (also FOSS) to post-process the generated 3D object.
<img alt="screenshot of meshroom GUI" loading="lazy" src="/posts/headlamp_on_a_bike/images/meshroom.webp"></p>
<h3 id="trial-and-error">Trial and Error<a hidden class="anchor" aria-hidden="true" href="#trial-and-error">#</a></h3>
<p>It actually took me 4 trials to get a somewhat useful scan of the bike handle and the stem.</p>
<ul>
<li>On the first try, I took the Sony Alpha 6000 mirrorless camera and added some pieces of white masking tape to the handle. The results were okay, but I wanted to have even better results - especially around the area of the stem.
<img alt="picture of scan results 1" loading="lazy" src="/posts/headlamp_on_a_bike/images/scan_results_1.webp"></li>
<li>Next up I tried the main camera of the Samsung Galaxy S21. I just wanted to see how far I can get with a phone camera. The results were quite disappointing, to be honest.
<img alt="picture of scan results 2" loading="lazy" src="/posts/headlamp_on_a_bike/images/scan_results_2.webp"></li>
<li>I still did not give up the idea of using my phone to <em>scan</em> the object. Besides the difference in image quality between my Sony&rsquo;s and Samsung&rsquo;s images, the most obvious difference was the <a href="https://en.wikipedia.org/wiki/Depth_of_field">depth of field (DOF)</a>. As you might expect, the mirrorless camera had much more background blur. I thought this might help the algorithms to focus more on the object and less on the background. To prove this theory, I have tried to use the 3x zoom lens on the Galaxy S21. Also here, the results were not what I expected.
<img alt="picture of scan results 3" loading="lazy" src="/posts/headlamp_on_a_bike/images/scan_results_3.webp"></li>
<li>Last but not least, I went back to the Sony Alpha and added even more pieces of white masking tape to help the algorithms, by providing distinguishable reference points all over the bike handle and stem.
<img alt="picture of scan results 4" loading="lazy" src="/posts/headlamp_on_a_bike/images/scan_results_4.webp"></li>
</ul>
<h3 id="miscellaneous">Miscellaneous<a hidden class="anchor" aria-hidden="true" href="#miscellaneous">#</a></h3>
<h4 id="meshroom-camera-intrinsics">Meshroom Camera Intrinsics<a hidden class="anchor" aria-hidden="true" href="#meshroom-camera-intrinsics">#</a></h4>
<p>When importing images into Meshroom you will see a yellow or green aperture symbol in the top left corner of the images. The yellow symbol shows that the camera intrinsics are approximated by the given metadata of the image. On contrary, the green aperture means that the camera intrinsics are calculated from the metadata and the camera sensor database.</p>
<p>In the case of the Samsung Galaxy S21, the sensor was not present in the database and therefore I got the following camera intrinsics:
<img alt="screenshot of approximated camera intrinsics in meshroom" loading="lazy" src="/posts/headlamp_on_a_bike/images/camera_intrinsics_approximated.webp"></p>
<p>Using the <a href="https://github.com/alicevision/Meshroom/wiki/Add-Camera-to-database">Meshroom guide on GitHub</a> I have added the phone&rsquo;s sensor to the database and got the following results:
<img alt="screenshot of estimated camera intrinsics in meshroom" loading="lazy" src="/posts/headlamp_on_a_bike/images/camera_intrinsics_estimated.webp"></p>
<p>Since it took me quite some time to get reliable information about the sensor size of the main camera on the Galaxy S21, I thought it makes sense to also contribute to the Meshroom/AliceVision project by creating a <a href="https://github.com/alicevision/AliceVision/pull/1205">pull request (PR)</a> for adding the sensor to the database.</p>
<h4 id="using-meshlab-for-cleaning-up-the-scan">Using MeshLab for cleaning up the Scan<a hidden class="anchor" aria-hidden="true" href="#using-meshlab-for-cleaning-up-the-scan">#</a></h4>
<p>As you can see in the <a href="#trial-and-error"><em>Trial and Error</em> section</a> above, some scans collect a lot of unwanted background stuff. I have used the FOSS tool MeshLab to clean up the model following <a href="https://www.youtube.com/watch?v=m2nmeJj5Ij4">this guide on YouTube</a>.</p>
<h2 id="final-design">Final Design<a hidden class="anchor" aria-hidden="true" href="#final-design">#</a></h2>
<p>After cleaning the model and exporting it as an STL file, it was imported into Fusion 360. Before the model can be used to design the holder it is necessary to scale it to fit real-life dimensions. Fortunately, Fusion offers an easy-to-use scale feature.
<img alt="screenshot of scaling procedure in Fusion 360" loading="lazy" src="/posts/headlamp_on_a_bike/images/fusion_scaling_1.webp"></p>
<p>You just need a reference point to compare the dimensions. In my case, I took the distance of the screws in the stem. Then you just divide the real-life value by the one you measured in your model. The result gives you then the scaling factor.
<img alt="screenshot of scaled model in Fusion 360" loading="lazy" src="/posts/headlamp_on_a_bike/images/fusion_scaling_2.webp"></p>
<p>Then the already designed clip interface was imported into this assembly. Even though I want to mount the light on the bottom of the bike stem, the design was done on the top side, since the scan was much better on the top of the stem. This was only possible because the stem showed symmetry between the top and bottom half.
<img alt="screenshot of imported interface clip in Fusion 360" loading="lazy" src="/posts/headlamp_on_a_bike/images/fusion_1.webp"></p>
<p>In the last step, the clip interface model was adapted to be mounted with the existing screws that hold the bike handle to the stem. By just using longer screws and cutting threads into the holes of the 3D printed part, it can be mounted without any additional modifications to the bike. Of course, also a chamfer was added to the part to interface more nicely with the stem.
<img alt="screenshot of Fusion 360 assembly" loading="lazy" src="/posts/headlamp_on_a_bike/images/fusion_2.webp"></p>
<h1 id="result-and-conclusion">Result and Conclusion<a hidden class="anchor" aria-hidden="true" href="#result-and-conclusion">#</a></h1>
<p><img alt="animated gif of mounting the light to the bike" loading="lazy" src="/posts/headlamp_on_a_bike/images/mounting_procedure.gif"></p>
<ul>
<li>Overall I am happy with how the mount turned out. It only adds a few grams to the bike and it is mounted rock solid. Also in case of a mild crash, it is much more protected on the bottom side of the stem - compared to how typical bike lights are mounted.</li>
<li>The modifications can quickly be undone and besides the changed screws the bike remained untouched.</li>
<li>I am definitely looking forward to using photogrammetry more often for designing around complex shapes. Although, I have to admit that it was a bit overkill for this project.</li>
<li>The other thing I have learned is that photogrammetry is a very time-consuming process. Not only does it take some time to prepare the object and take the pictures, but also a lot (if not the most) of time spent is waiting for the model to be generated.</li>
<li>The bike light in action:
<img alt="picture of the mounted light" loading="lazy" src="/posts/headlamp_on_a_bike/images/final_result_1.webp">
<img alt="picture of the mounted light in the dark 1" loading="lazy" src="/posts/headlamp_on_a_bike/images/final_result_2.webp">
<img alt="picture of the mounted light in the dark 2" loading="lazy" src="/posts/headlamp_on_a_bike/images/final_result_3.webp"></li>
</ul>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://dadul96.github.io/tags/3d-printing/">3D Printing</a></li>
      <li><a href="https://dadul96.github.io/tags/photogrammetry/">Photogrammetry</a></li>
      <li><a href="https://dadul96.github.io/tags/3d-design/">3D Design</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://dadul96.github.io/posts/stm32_usb_hid_mouse_jiggler/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>STM32 USB HID Mouse Jiggler</span>
  </a>
</nav>

  </footer><script src="https://giscus.app/client.js"
        data-repo="dadul96/dadul96.github.io"
        data-repo-id="R_kgDOGzFyKw"
        data-category="Announcements"
        data-category-id="DIC_kwDOGzFyK84ClYDq"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="transparent_dark"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://dadul96.github.io/">dadul96 blog</a></span> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
